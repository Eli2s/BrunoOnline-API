generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Client {
  id        Int       @id @default(autoincrement())
  name      String
  nickname  String
  whatsapp  String
  photo     String?
  tags      Json      @default("[]")
  createdAt DateTime  @default(now()) @map("created_at")

  services  Service[]
  plans     Plan[]
  cashbacks Cashback[]

  @@map("clients")
}

model Service {
  id                Int      @id @default(autoincrement())
  clientId          Int      @map("client_id")
  date              String
  services          Json     @default("[]")
  products          Json     @default("[]")
  totalValue        Float    @map("total_value")
  paymentMethod     String   @map("payment_method")
  observation       String?
  usedPlanCredit    Boolean  @default(false) @map("used_plan_credit")
  barberId          Int?     @map("barber_id")
  barberCommission  Float?   @map("barber_commission")
  shopValue         Float?   @map("shop_value")
  cashbackApplied   Float?   @map("cashback_applied")
  cashbackPercentage Float?  @map("cashback_percentage")

  client            Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  barber            Barber?  @relation(fields: [barberId], references: [id], onDelete: SetNull)

  @@map("services")
}

model Plan {
  id           Int           @id @default(autoincrement())
  clientId     Int           @map("client_id")
  name         String
  description  String
  value        Float
  periodicity  String
  customDays   Int?          @map("custom_days")
  startDate    String        @map("start_date")
  nextCharge   String        @map("next_charge")
  status       String        @default("ativo")
  benefits     String?
  internalNote String?       @map("internal_note")
  createdAt    DateTime      @default(now()) @map("created_at")

  client       Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  payments     PlanPayment[]

  @@map("plans")
}

model Product {
  id          Int     @id @default(autoincrement())
  name        String
  category    String
  price       Float
  stock       Int     @default(0)
  description String?
  image       String?

  @@map("products")
}

model PlanPayment {
  id           Int      @id @default(autoincrement())
  planId       Int      @map("plan_id")
  expectedDate String   @map("expected_date")
  paidDate     String?  @map("paid_date")
  status       String   @default("pendente")
  value        Float

  plan         Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@map("plan_payments")
}

model ServiceItem {
  id    Int    @id @default(autoincrement())
  name  String
  price Float

  @@map("service_items")
}

model Order {
  id               Int      @id @default(autoincrement())
  items            Json     @default("[]")
  totalValue       Float    @map("total_value")
  customerName     String   @map("customer_name")
  customerWhatsapp String   @map("customer_whatsapp")
  paymentMethod    String   @map("payment_method")
  status           String   @default("pendente")
  createdAt        DateTime @default(now()) @map("created_at")

  @@map("orders")
}

model Barber {
  id                Int      @id @default(autoincrement())
  name              String
  nickname          String
  whatsapp          String
  photo             String?
  defaultCommission Float    @map("default_commission")
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")

  services          Service[]
  commissions       BarberItemCommission[]

  @@map("barbers")
}

model BarberItemCommission {
  id         Int    @id @default(autoincrement())
  barberId   Int    @map("barber_id")
  itemId     Int    @map("item_id")
  itemType   String @map("item_type")
  percentage Float

  barber     Barber @relation(fields: [barberId], references: [id], onDelete: Cascade)

  @@map("barber_item_commissions")
}

model Cashback {
  id               Int      @id @default(autoincrement())
  clientId         Int      @map("client_id")
  percentage       Float
  startDate        String   @map("start_date")
  expirationDate   String   @map("expiration_date")
  status           String   @default("ativo")
  serviceId        Int?     @map("service_id")
  lastReminderSent String?  @map("last_reminder_sent")

  client           Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("cashbacks")
}

model MessageTemplate {
  id      Int    @id @default(autoincrement())
  type    String
  name    String
  content String

  @@map("message_templates")
}

model AppSettings {
  key   String @id
  value String

  @@map("app_settings")
}
